<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel</title>

<link rel="stylesheet" href="admin.css" />

</head>
<body>
<h1>Админ панель</h1>
<button id="logoutBtn">Выйти</button>
<hr />
<label for="deviceIdInput">Device ID пользователя:</label>
<input type="text" id="deviceIdInput" placeholder="Введите deviceID" />
<button id="loadUserBtn">Загрузить данные пользователя</button>

<div id="notification"></div>

<div id="userData" class="hidden">
  <h3>Данные пользователя</h3>
  <label>Wood: <input type="number" id="woodInput" /></label>
  <label>Workers: <input type="number" id="workersInput" /></label>
  <label>Prestige Bonus: <input type="number" id="prestigeBonusInput" /></label>
  <button id="saveUserBtn">Сохранить изменения</button>
  <div id="saveMessage"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<!-- Здесь либо подключай свой внешний файл с конфигом -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAOqsclFbwauR4XyadH1TNJys149Mx7tHI",
    authDomain: "lesorub-e022b.firebaseapp.com",
    databaseURL: "https://lesorub-e022b-default-rtdb.firebaseio.com",
    projectId: "lesorub-e022b",
    storageBucket: "lesorub-e022b.firebasestorage.app",
    messagingSenderId: "634001284128",
    appId: "1:634001284128:web:3002d6d0bc1338ff1c7045"
  };
  firebase.initializeApp(firebaseConfig);
</script>

<script>
  const auth = firebase.auth();
  const db = firebase.database();

  const logoutBtn = document.getElementById('logoutBtn');
  const deviceIdInput = document.getElementById('deviceIdInput');
  const loadUserBtn = document.getElementById('loadUserBtn');
  const userDataDiv = document.getElementById('userData');
  const woodInput = document.getElementById('woodInput');
  const workersInput = document.getElementById('workersInput');
  const prestigeBonusInput = document.getElementById('prestigeBonusInput');
  const saveUserBtn = document.getElementById('saveUserBtn');
  const saveMessage = document.getElementById('saveMessage');

  // Проверка авторизации: если не залогинен, редирект на login
  auth.onAuthStateChanged(user => {
    if (!user) {
      window.location.href = 'index.html';
    }
  });

  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  loadUserBtn.addEventListener('click', () => {
    const deviceId = deviceIdInput.value.trim();
    if (!deviceId) return alert('Введите deviceID');
    saveMessage.textContent = '';
    userDataDiv.classList.add('hidden');

    db.ref('users/' + deviceId).get().then(snapshot => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        woodInput.value = data.wood || 0;
        workersInput.value = data.workers || 0;
        prestigeBonusInput.value = data.prestigeBonus || 0;
        userDataDiv.classList.remove('hidden');
      } else {
        alert('Пользователь не найден');
      }
    }).catch(err => {
      alert('Ошибка загрузки данных: ' + err.message);
    });
  });

  saveUserBtn.addEventListener('click', () => {
    const deviceId = deviceIdInput.value.trim();
    if (!deviceId) return alert('Введите deviceID');

    const updatedData = {
      wood: Number(woodInput.value),
      workers: Number(workersInput.value),
      prestigeBonus: Number(prestigeBonusInput.value)
    };

    db.ref('users/' + deviceId).update(updatedData)
      .then(() => {
        saveMessage.textContent = 'Данные успешно сохранены';
      })
      .catch(err => {
        saveMessage.textContent = 'Ошибка сохранения: ' + err.message;
      });
  });
</script>
</body>
</html>
