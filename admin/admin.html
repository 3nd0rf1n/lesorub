<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Админка с защитой</title>

<!-- manifest для админки -->
<link rel="manifest" href="manifest.json">

<button id="installBtn" style="display: none; margin: 20px auto; display: block; padding: 10px 20px; font-size: 16px; background-color: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer;">
  Установить приложение
</button>


<!-- регистрация service-worker для админки -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js', { scope: './' })
      .then(reg => {
        console.log('Admin Service Worker зарегистрирован!', reg);
      })
      .catch(err => {
        console.error('Ошибка регистрации Service Worker:', err);
      });
  }
</script>

<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
  #adminPanel { display: none; max-width: 320px; margin: 30px auto; padding: 15px; border: 2px solid #444; border-radius: 8px; background: #f7f7f7; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
  #passwordModal {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999;
  }
  #passwordModalContent {
    background: white; padding: 20px 30px; border-radius: 8px; max-width: 300px; width: 100%; text-align: center;
  }
  #passwordInput {
    width: 100%; padding: 10px; margin: 15px 0; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;
  }
  #passwordSubmitBtn {
    padding: 10px 20px; font-size: 16px; border: none; background: #4caf50; color: white; border-radius: 5px; cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #passwordSubmitBtn:hover {
    background-color: #45a049;
  }
  #errorMsg {
    color: red; font-size: 14px; min-height: 18px;
  }
</style>
</head>
<body>

<!-- Модальное окно с паролем -->
<div id="passwordModal">
  <div id="passwordModalContent">
    <h2>Введите пароль</h2>
    <input type="password" id="passwordInput" placeholder="Пароль" autocomplete="off" />
    <div id="errorMsg"></div>
    <button id="passwordSubmitBtn">Войти</button>
  </div>
</div>

<!-- Админ-панель -->
<div id="adminPanel">
  <h3>Админ-панель</h3>
  <label>Дерево:<br>
    <input type="number" id="adminWood" min="0" />
  </label><br><br>

  <label>Рабочие:<br>
    <input type="number" id="adminWorkers" min="0" />
  </label><br><br>

  <label>Престиж:<br>
    <input type="number" id="adminPrestige" min="0" />
  </label><br><br>

  <button id="saveAdminBtn">Сохранить</button>
</div>

<script>
  // Простой пароль (без хешей)
  const CORRECT_PASSWORD = '200613a';

  const passwordModal = document.getElementById('passwordModal');
  const passwordInput = document.getElementById('passwordInput');
  const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
  const errorMsg = document.getElementById('errorMsg');
  const adminPanel = document.getElementById('adminPanel');

  function checkPassword() {
    const entered = passwordInput.value;
    if (entered === CORRECT_PASSWORD) {
      sessionStorage.setItem('adminAuthorized', 'true');
      passwordModal.style.display = 'none';
      adminPanel.style.display = 'block';
      fillAdminPanel();
    } else {
      errorMsg.textContent = 'Неверный пароль. Попробуйте снова.';
      passwordInput.value = '';
      passwordInput.focus();
    }
  }

  passwordSubmitBtn.addEventListener('click', checkPassword);
  passwordInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      checkPassword();
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    if (sessionStorage.getItem('adminAuthorized') === 'true') {
      passwordModal.style.display = 'none';
      adminPanel.style.display = 'block';
      fillAdminPanel();
    }
  });

  function fillAdminPanel() {
    document.getElementById('adminWood').value = localStorage.getItem('wood') || 0;
    document.getElementById('adminWorkers').value = localStorage.getItem('workers') || 0;
    document.getElementById('adminPrestige').value = localStorage.getItem('prestige') || 0;
  }

  document.getElementById('saveAdminBtn').addEventListener('click', () => {
    const wood = parseInt(document.getElementById('adminWood').value) || 0;
    const workers = parseInt(document.getElementById('adminWorkers').value) || 0;
    const prestige = parseInt(document.getElementById('adminPrestige').value) || 0;

    localStorage.setItem('wood', wood);
    localStorage.setItem('workers', workers);
    localStorage.setItem('prestige', prestige);

    alert('Данные успешно сохранены!');
  });
</script>

<script>let deferredPrompt;
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault(); // Блокируем авто-появление баннера
  deferredPrompt = e;
  installBtn.style.display = 'block';
});

installBtn.addEventListener('click', () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(choice => {
      if (choice.outcome === 'accepted') {
        console.log('Приложение установлено');
      } else {
        console.log('Установку отменили');
      }
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });
  }
});
</script>

</body>
</html>
